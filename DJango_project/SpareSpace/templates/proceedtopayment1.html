<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    {% load static %}
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        function pay1() {
            var formdata = new FormData();
            formdata.append('roomid', document.getElementById('rid').value);
            formdata.append('persons', document.getElementById('person').value);
            formdata.append('extraperson', document.getElementById('extra').value);
            formdata.append('checkin', document.getElementById('checkin').value);
            formdata.append('checkout', document.getElementById('checkout').value);
            formdata.append('total', document.getElementById('total').value);
            formdata.append('email', document.getElementById('email').value);
            formdata.append('mobile', document.getElementById('mobile').value);
            formdata.append('address', document.getElementById('address').value);
            formdata.append('hostid', document.getElementById('hostid').value);
            formdata.append('paymentmode', document.getElementById('paymentmode').value);
            if (document.getElementById('paymentmode').value == 'Cash') {
                var xml = new XMLHttpRequest();
                xml.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        var ar = JSON.parse(this.response);
                        console.log(ar);
                        window.location.href = "thankspage?bookingid=" + ar['bookingid'] + "&amount=" + document.getElementById("total").value + "&status=pending";
                    }
                };
                xml.open('POST', 'userbooking', true);
                xml.send(formdata);
            } else {
                var grandtotal = parseFloat(document.getElementById('total1').value);
                var options = {
                    "key": "rzp_test_dRWiKHS7zr2Gki",
                    "amount": grandtotal,
                    "name": "SpareSpace",
                    "description": "Online Payment System",
                    "image": "http://ecourses.aec.edu.in/aditya/images/po4.png",
                    "handler": function (response) {
                        {#alert(response.razorpay_payment_id);#}

                        if (response.razorpay_payment_id == "") {
                            alert('Failed');
                            {#window.location.href = "bookingaction?status=failed";#}
                        } else {
                            alert('Success');
                            {#    window.location.href = "bookingaction?status=success&&gt=" + grandtotal;#}

                            var xml = new XMLHttpRequest();
                            xml.onreadystatechange = function () {
                                if (this.readyState == 4 && this.status == 200) {
                                    var ar = JSON.parse(this.response);
                                    console.log(ar);
                                    alert(ar['bookingid']);
                                    window.location.href = "thankspage?bookingid=" + ar['bookingid'] + "&amount=" + document.getElementById("total").value + "&status=success";

                                }
                            };
                            xml.open('POST', 'userbooking', true);
                            xml.send(formdata);
                        }
                    },
                    "prefill": {
                        "name": "",
                        "email": document.getElementById("email").value,
                    },
                    "notes": {
                        "address": ""
                    },
                    "theme": {
                        "color": "#F37254"
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            }
        }

    </script>
</head>
<body>
{% include 'indexheaderfiles.html' %}
{% include 'indexnavbaruser.html' %}
<div class="container" style="margin-top: 10px;">
    <div class="text-center"><h3 style="color: #a71d2a">Details</h3></div>

    <div class="row" style="margin-top: 50px">
        <div class="col-sm-6">
            <h4>Roomid</h4>
            <p>{{ ar.rid }}</p>
            <h4>Roomname</h4>
            <p>{{ ar1.roomname }}</p>
            <h4>Area</h4>
            <p>{{ ar1.area }}</p>
            <h4>Coverphoto</h4>
            <img style="width: 100px; height: 100px; margin-top: 50px;" src="{% static "media/" %}{{ ar1.coverphoto }}">
        </div>
        <div class="col-sm-6">
            <h4>Checkin</h4>
            <p>{{ ar.checkin }}</p>
            <h4>Checkout</h4>
            <p>{{ ar.checkout }}</p>
            <h4>Charges</h4>
            <p>{{ ar.total }}</p>
        </div>
    </div>
<form action="" id="userbookingvalid" method="post">
    <input type="hidden" id="rid" name="rid" value="{{ ar.rid }}">
    <input type="hidden" id="person" name="person" value="single">
    <input type="hidden" id="extra" name="extra" value="0">
    <input type="hidden" id="checkin" name="checkin" value="{{ ar.checkin}}">
    <input type="hidden" id="checkout" name="checkout" value="{{ ar.checkout}}">
    <input type="hidden" id="total" name="total" value="{{ ar.total }}">
    <input type="hidden" id="total1" name="total1" value="{{ ar.ts }}">
    <input type="hidden" id="email" name="email" value="{{ ar2.email }}">
    <input type="hidden" id="mobile" name="mobile" value="{{ ar2.mobile }}">
    <input type="hidden" id="address" name="address" value="{{ ar2.address }}">
    <input type="hidden" id="hostid" name="hostid" value="{{ ar.hid }}">
    <div class="form-group text-center">
        <select id="paymentmode" name="paymentmode">
            <option value="">Choose Payment Mode</option>
            <option value="Cash">Cash</option>
            <option value="online">Online</option>
        </select>
    </div>
    <div class="form-group text-center">
        <input type="button" class="btn btn-success" value="Pay" onclick="pay1()">
    </div>
 </form>
</div>
</body>
</html>