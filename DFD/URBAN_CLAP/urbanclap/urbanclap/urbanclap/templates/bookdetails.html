<!DOCTYPE html>
<html lang="en">
<head>
    {% load static  %}
    <meta charset="UTF-8">
    <title>Booking Details</title>

    <link rel="stylesheet" href="{% static "css/bootstrap.css" %}">
    <link rel="stylesheet" href="{% static 'clock/dist/bootstrap-clockpicker.css' %}">
    <script src="{% static 'js/jquery-3.4.1.min.js' %}"></script>
    <script src="{% static 'js/popper.js' %}"></script>
    <script src="{% static 'js/bootstrap.js' %}"></script>
    <script src="{% static 'clock/dist/jquery-clockpicker.js' %}"></script>
    {#    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">#}
    <link rel="stylesheet" href="{% static 'jquery-ui-1.12.1/jquery-ui.css' %}">
    {#    <link rel="stylesheet" href="/resources/demos/style.css">#}
    {#    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>#}
    <script src="{% static 'jquery-ui-1.12.1/jquery-ui.js' %}"></script>
    {% include 'indexheader.html' %}

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
        function pay() {
            var formdata = new FormData();
            formdata.append('spemail', document.getElementById('spemail').value);
            formdata.append('date', document.getElementById('date').value);
            formdata.append('timefrom', document.getElementById('timefrom').value);
            formdata.append('timeto', document.getElementById('timeto').value);
            formdata.append('place', document.getElementById('place').value);
            formdata.append('paymentmode', document.getElementById('paymentmode').value);
            formdata.append('price', document.getElementById('price').value);
            if (document.getElementById('paymentmode').value == 'Cash') {
                var xml = new XMLHttpRequest();
                xml.onreadystatechange = function () {
                    if (this.readyState == 4 && this.status == 200) {
                        var ar = JSON.parse(this.response);
                        console.log(ar);
                        window.location.href = "thankyou?bid=" + ar['bid'];
                    }
                };
                xml.open('POST', 'payment_action', true);
                xml.send(formdata);
            } else {
                var total = parseFloat(document.getElementById('price').value) * 100;
                var options = {
                    "key": "rzp_test_dRWiKHS7zr2Gki",
                    "amount": total,
                    "name": "Booking System",
                    "description": "Online Payment System",
                    "image": "http://ecourses.aec.edu.in/aditya/images/po4.png",
                    "handler": function (response) {
                        //alert(response.razorpay_payment_id);
                        if (response.razorpay_payment_id == "") {
                            //alert('Failed');
                            {#window.location.href = "bookingaction?status=failed";#}
                        } else {
                            //alert('Success');
                            {#window.location.href = "bookingaction?status=success&&gt=" + grandtotal;#}
                        }
                        var xml = new XMLHttpRequest();
                        xml.onreadystatechange = function () {
                            if (this.readyState == 4 && this.status == 200) {
                                var ar = JSON.parse(this.response);
                                console.log(ar);
                                window.location.href = "thankyou?bid=" + ar['bid'];
                            }
                        };
                        xml.open('POST', 'payment_action', true);
                        xml.send(formdata);
                    },
                    "prefill": {
                        "name": "",
                        "email": ""
                    },
                    "notes": {
                        "address": ""
                    },
                    "theme": {
                        "color": "#F37254"
                    }
                };
                var rzp1 = new Razorpay(options);
                rzp1.open();
            }
        }
    </script>
    <script>
        $(function () {
            $(".datepicker").datepicker({
                dateFormat: 'yy-mm-dd',
                changeYear:true,
                changeMonth:true,
                minDate:0
            });
        });
    </script>
</head>
<body style="background-color: #888888">

{% include 'navbarUser.html' %}
<div class="container" style="margin-top:150px">
    <div class="form-group">
        <h1 class="text-center">Booking Details</h1>
    </div>
    <form id="bookdetails" action="">

        <div class="row">
            <div class="col-sm-6">
                <div class="form-group">
                    <label for="email">User Email:</label>
                    <input type="email" readonly value="{{ request.session.useremail }}" data-rule-required="true"
                           class="form-control" name="useremail"
                           id="useremail">
                </div>
                <div class="form-group">
                    <label for="email">Service Provider Email:</label>
                    <input type="email" readonly value="{{ ar.email }}" data-rule-required="true" class="form-control"
                           name="spemail"
                           id="spemail">
                </div>
                <div class="form-group">
                    <label for="date">Date Of Booking*:</label>
                    <input type="text" class="form-control datepicker" placeholder="Choose Date"
                           data-msg-required="Choose Date" readonly data-rule-required="true" name="date" id="date">
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="form-group clockpicker">
                                <label for="timefrom">Time From*</label>
                                <input id="timefrom" type="text" class="form-control" placeholder="Choose your time"
                                       readonly>
                                <span class="input-group-addon">
                        <span class="glyphicon glyphicon-time"></span>
                    </span>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="form-group clockpicker">
                                <label for="timeto">To*</label>
                                <input id="timeto" type="text" data-rule-required="true"
                                       data-msg-required="Enter Location"
                                       class="form-control" placeholder="Choose your time" readonly>
                                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-time"></span>
                    </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-sm-6">
                <div class="form-group">
                    <label for="location">Address*:</label>
                    <input type="text" data-rule-required="true"
                           data-msg-required="Enter Address" placeholder="Enter Address" class="form-control"
                           name="place" id="place">
                </div>
                <div class="form-group">
                    <label for="paymentmode">Payment Mode*:</label>
                    <select class="form-control" name="paymentmode" id="paymentmode" data-rule-required="true"
                            data-msg-required="*">
                        <option class="Cash">Cash</option>
                        <option class="By Card">By Card</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="price">Price:</label>
                    <input type="text" readonly value="{{ ar.price }}" data-rule-required="true" class="form-control"
                           name="price" id="price">
                </div>
                <div class="form-group">
                    <button type="button" class="btn btn-success mt-4 form-control w-50" onclick="pay()">Pay Now
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>
</div>
</div>

<script type="text/javascript">
    $(document).ready(function () {
        $('.clockpicker').clockpicker();
    });
</script>
</body>
</html>